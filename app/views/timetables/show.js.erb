<% @timetables.each do |timetable| %>
  $('table').append("<%= j (render timetable) %>");
  $("#show_<%=timetable.id%>").remove(); // delete checkbox from groups_form
  <%events = timetable.events%>
  <%events.each do |event|%>
    $('td[data-week="<%= event.week %>"]', 'tr[data-timetable="<%= timetable.id %>"]').append("<%= j (render event) %>");
  <%end%>
<% end %>

$('div.events').draggable({
  containment: 'table',
  revert: 'invalid'
});
$('td.events').droppable({
  accept: 'div.events',
  tolerance: 'intersect',
  drop: function (event, ui) {
    if ($('div', this).length == 0) {
      $div = $(ui.draggable);
      $div.appendTo($(this));
      var event_id = $div.data('event');
      var week = $(this).data('week');
      var timetable_id = $(this).parent().data('timetable');
      moveEvent(event_id, week, timetable_id);
      $div.css({
        'top': '0px',
        'left': '0px'
      });
    } else {
      $(ui.draggable).animate({top: 0, left: 0}, 'slow'); //revert
    }
  }
});
$('#download').fadeOut(400);
