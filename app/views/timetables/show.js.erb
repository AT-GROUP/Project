<% if @show!=nil %>
  <%@show.keys.each do |i|%>
    <%if @show["#{i}"]=="1"%>
      <%timetable = Timetable.find_by id: i%>
      $('table').append("<%= j (render timetable) %>");
      $("#show_<%=i%>").remove();
      <%events = timetable.events%>
      <%events.each do |event|%>
          $('td[data-week="<%= event.week %>"]','tr[data-timetable="<%= timetable.id %>"]').append("<%= j (render event) %>");
      <%end%>
    <%end%>
  <%end%>
<% end %>

$('div.events').draggable({
  containment: 'table',
  revert: 'invalid'
});
$('td.events').droppable({
  accept: 'div.events',
  tolerance: 'intersect',
  drop: function (event, ui) {
    if ($('div', this).length == 0) {
      $div = $(ui.draggable);
      $div.appendTo($(this));
      var event_id = $div.data('event');
      var week = $(this).data('week');
      var timetable_id = $(this).parent().data('timetable');
      moveEvent(event_id, week, timetable_id);
      $div.css({
        'top': '0px',
        'left': '0px'
      });
    } else {
      $(ui.draggable).animate({top: 0, left: 0}, 'slow'); //revert
    }
  }
});
$(document).on('scroll', function(){
  var leftScroll = $(document).scrollLeft();
  $('.num').css({'left':-leftScroll});
});
$('#download').fadeOut(400);
